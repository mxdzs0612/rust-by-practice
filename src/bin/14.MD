# Package and Crate
`package` æ˜¯ä½ é€šè¿‡ `Cargo` åˆ›å»ºçš„å·¥ç¨‹æˆ–é¡¹ç›®ï¼Œå› æ­¤åœ¨ `package` çš„æ ¹ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ª `Cargo.toml` æ–‡ä»¶ã€‚

1. ğŸŒŸ åˆ›å»ºä¸€ä¸ª `package`ï¼Œæ‹¥æœ‰ä»¥ä¸‹ç›®å½•ç»“æ„:
```shell
.
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
    â””â”€â”€ main.rs

1 directory, 2 files
```

```toml
# in Cargo.toml
[package]
name = "hello-package"
version = "0.1.0"
edition = "2021"
```

> æ³¨æ„! æˆ‘ä»¬ä¼šåœ¨åŒ…ä¸æ¨¡å—ä¸­ä½¿ç”¨ä¸Šé¢çš„é¡¹ç›®ä½œä¸ºæ¼”ç¤ºï¼Œå› æ­¤ä¸è¦åˆ é™¤

2. ğŸŒŸ åˆ›å»ºä¸€ä¸ª packageï¼Œæ‹¥æœ‰ä»¥ä¸‹ç›®å½•ç»“æ„:
```shell
.
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
    â””â”€â”€ lib.rs

1 directory, 2 files
```

```toml
# in Cargo.toml
[package]
name = "hello-package1"
version = "0.1.0"
edition = "2021"
```

> è¯¥é¡¹ç›®å¯ä»¥å®‰å…¨çš„ç§»é™¤

3. ğŸŒŸ 
```rust,editable
/* ä½¿ç”¨ä½ çš„ç­”æ¡ˆå¡«ç©º */

// Q: package 1# å’Œ 2# çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ ?
// A: åå­—ä¸ä¸€æ ·ï¼Œå†…å®¹ä¸€ä¸ªæ˜¯mainä¸€ä¸ªæ˜¯lib
```


## åŒ…Crate
ä¸€ä¸ªåŒ…å¯ä»¥æ˜¯äºŒè¿›åˆ¶ä¹Ÿå¯ä»¥ä¸€ä¸ªä¾èµ–åº“ã€‚æ¯ä¸€ä¸ªåŒ…éƒ½æœ‰ä¸€ä¸ªåŒ…æ ¹ï¼Œä¾‹å¦‚äºŒè¿›åˆ¶åŒ…çš„åŒ…æ ¹æ˜¯ `src/main.rs`ï¼Œåº“åŒ…çš„åŒ…æ ¹æ˜¯ `src/lib.rs`ã€‚åŒ…æ ¹æ˜¯ç¼–è¯‘å™¨å¼€å§‹å¤„ç†æºä»£ç æ–‡ä»¶çš„åœ°æ–¹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯åŒ…æ¨¡å—æ ‘çš„æ ¹éƒ¨ã€‚ 

åœ¨ package `hello-package` ä¸­ï¼Œæœ‰ä¸€ä¸ªäºŒè¿›åˆ¶åŒ…ï¼Œè¯¥åŒ…ä¸ `package` åŒå : `hello-package`,  å…¶ä¸­ `src/main.rs` æ˜¯è¯¥äºŒè¿›åˆ¶åŒ…çš„åŒ…æ ¹.

ä¸ `hello-package` ç±»ä¼¼, `hello-package1` åŒæ ·åŒ…å«ä¸€ä¸ªåŒ…ï¼Œä½†æ˜¯ä¸ä¹‹å‰çš„äºŒè¿›åˆ¶åŒ…ä¸åŒï¼Œè¯¥ package åŒ…å«çš„æ˜¯åº“åŒ…ï¼Œå…¶ä¸­ `src/lib.rs` æ˜¯å…¶åŒ…æ ¹.

4. ğŸŒŸ
```rust,editable
/* å¡«ç©º */

// Q: package `hello-package1` ä¸­çš„åº“åŒ…åç§°æ˜¯?
// A: hello-package1
```


5. ğŸŒŸğŸŒŸ ä¸º `hello-package` æ·»åŠ ä¸€ä¸ªåº“åŒ…ï¼Œå¹¶ä¸”å®Œæˆä»¥ä¸‹ç›®å½•ç»“æ„çš„å¡«ç©º:
```shell,editable
# å¡«ç©º
.
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ lib.rs
â”‚   â””â”€â”€ main.rs
```

åœ¨ä¸Šä¸€ä¸ªæ­¥éª¤åï¼Œæˆ‘ä»¬çš„ `hello-package` ä¸­å·²ç»å­˜åœ¨ä¸¤ä¸ªåŒ…ï¼šä¸€ä¸ªäºŒè¿›åˆ¶åŒ…å’Œä¸€ä¸ªåº“åŒ…ï¼Œä¸¤ä¸ªåŒ…çš„åç§°éƒ½ä¸ package ç›¸åŒï¼š`hello-package`ã€‚



6. ğŸŒŸğŸŒŸğŸŒŸ ä¸€ä¸ª package æœ€å¤šåªèƒ½åŒ…å«ä¸€ä¸ªåº“åŒ…ï¼Œä½†æ˜¯å´å¯ä»¥åŒ…å«å¤šä¸ªäºŒè¿›åˆ¶åŒ…ï¼šé€šè¿‡å°†äºŒè¿›åˆ¶æ–‡ä»¶æ”¾å…¥åˆ° `src/bin` ç›®å½•ä¸‹å®ç°: **è¯¥ç›®å½•ä¸‹çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„äºŒè¿›åˆ¶åŒ…ï¼ŒåŒ…åä¸æ–‡ä»¶åç›¸åŒï¼Œä¸å†ä¸ package çš„åç§°ç›¸åŒã€‚**.

```shell,editable
# åˆ›å»ºä¸€ä¸ª a package åŒ…å«ä»¥ä¸‹åŒ…ï¼š 
# 1. ä¸‰ä¸ªäºŒè¿›åˆ¶åŒ…: `hello-package`, `main1` and `main2`
# 2. ä¸€ä¸ªåº“åŒ…
# å¹¶å®Œæˆä»¥ä¸‹ç›®å½•ç»“æ„çš„å¡«ç©º
.
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ lib.rs
â”‚   â”œâ”€â”€ main.rs
â”‚   â””â”€â”€ bin
â”‚       â””â”€â”€ main1.rs
â”‚       â””â”€â”€ main2.rs
â”œâ”€â”€ tests # å­˜æ”¾é›†æˆæµ‹è¯•æ–‡ä»¶çš„ç›®å½•
â”‚   â””â”€â”€ some_integration_tests.rs
â”œâ”€â”€ benches # å­˜æ”¾ benchmark æ–‡ä»¶çš„ç›®å½•dir for benchmark files
â”‚   â””â”€â”€ simple_bench.rs
â””â”€â”€ examples # å­˜æ”¾ç¤ºä¾‹æ–‡ä»¶çš„ç›®å½•
    â””â”€â”€ simple_example.rs
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ package ç»“æ„éå¸¸æ ‡å‡†ï¼Œä½ å¯ä»¥åœ¨å¾ˆå¤š Rust é¡¹ç›®ä¸­çœ‹åˆ°è¯¥ç»“æ„çš„èº«å½±ã€‚


> ä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/sunface/rust-by-practice/blob/master/solutions/crate-module/crate.md)æ‰¾åˆ°ç­”æ¡ˆ(åœ¨ solutions è·¯å¾„ä¸‹) 

# Module
åœ¨ Rust è¯­è¨€åœ£ç»ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ·±å…¥è®²è§£è¿‡[æ¨¡å—module](https://course.rs/basic/crate-module/module.html)ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œç›´æ¥å¼€å§‹æˆ‘ä»¬çš„ç»ƒä¹ ã€‚

ä¹‹å‰æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª package `hello-package`ï¼Œå®ƒçš„ç›®å½•ç»“æ„åœ¨ç»è¿‡å¤šæ¬¡ä¿®æ”¹åï¼Œå˜æˆäº†ä»¥ä¸‹æ¨¡æ ·:

```shell
.
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ lib.rs
â”‚   â””â”€â”€ main.rs
```

ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥ä¸ºå…¶ä¸­çš„åº“åŒ…åˆ›å»ºä¸€äº›æ¨¡å—ï¼Œç„¶ååœ¨äºŒè¿›åˆ¶åŒ…ä¸­ä½¿ç”¨è¿™äº›æ¨¡å—ã€‚

1. ğŸŒŸğŸŒŸ æ ¹æ®ä»¥ä¸‹çš„æ¨¡å—æ ‘æè¿°å®ç°æ¨¡å— `front_of_house` :
```shell
åº“åŒ…çš„æ ¹(src/lib.rs)
 â””â”€â”€ front_of_house
     â”œâ”€â”€ hosting
     â”‚   â”œâ”€â”€ add_to_waitlist
     â”‚   â””â”€â”€ seat_at_table
     â””â”€â”€ serving
         â”œâ”€â”€ take_order
         â”œâ”€â”€ serve_order
         â”œâ”€â”€ take_payment
         â””â”€â”€ complain
```

```rust,editable
// å¡«ç©º
// in __.rs

mod front_of_house {
    // å®ç°æ­¤æ¨¡å—
}
```


2. ğŸŒŸğŸŒŸ è®©æˆ‘ä»¬åœ¨åº“åŒ…çš„æ ¹ä¸­å®šä¹‰ä¸€ä¸ªå‡½æ•° `eat_at_restaurant`, ç„¶ååœ¨è¯¥å‡½æ•°ä¸­è°ƒç”¨ä¹‹å‰åˆ›å»ºçš„å‡½æ•° `eat_at_restaurant`

```rust,editable
// in lib.rs

// å¡«ç©ºå¹¶ä¿®å¤é”™è¯¯

// æç¤ºï¼šä½ éœ€è¦é€šè¿‡ `pub` å°†ä¸€äº›é¡¹æ ‡è®°ä¸ºå…¬æœ‰çš„ï¼Œè¿™æ ·æ¨¡å— `front_of_house` ä¸­çš„é¡¹æ‰èƒ½è¢«æ¨¡å—å¤–çš„é¡¹è®¿é—®
mod front_of_house {
    /* ...snip... */
}

pub fn eat_at_restaurant() {
    // ä½¿ç”¨ç»å¯¹è·¯å¾„è°ƒç”¨
    __.add_to_waitlist();

    // ä½¿ç”¨ç›¸å¯¹è·¯å¾„è°ƒç”¨
     __.add_to_waitlist();
}
```

3. ğŸŒŸğŸŒŸ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ `super` æ¥å¯¼å…¥çˆ¶æ¨¡å—ä¸­çš„é¡¹
```rust,editable
// in lib.rs

mod back_of_house {
    fn fix_incorrect_order() {
        cook_order();
        // ä½¿ç”¨ä¸‰ç§æ–¹å¼å¡«ç©º
        //1. ä½¿ç”¨å…³é”®å­— `super`
        //2. ä½¿ç”¨ç»å¯¹è·¯å¾„
        __.serve_order();
    }

    fn cook_order() {}
}
```


### å°†æ¨¡å—åˆ†ç¦»å¹¶æ”¾å…¥ç‹¬ç«‹çš„æ–‡ä»¶ä¸­
```rust
// in lib.rs
pub mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {}

        pub fn seat_at_table() -> String {
            String::from("sit down please")
        }
    }

    pub mod serving {
        pub fn take_order() {}

        pub fn serve_order() {}

        pub fn take_payment() {}

        // æˆ‘çŒœä½ ä¸å¸Œæœ›é¡¾å®¢å¬åˆ°ä½ åœ¨æŠ±æ€¨ä»–ä»¬ï¼Œå› æ­¤è®©è¿™ä¸ªå‡½æ•°ç§æœ‰åŒ–å§
        fn complain() {} 
    }
}

pub fn eat_at_restaurant() -> String {
    front_of_house::hosting::add_to_waitlist();
    
    back_of_house::cook_order();

    String::from("yummy yummy!")
}

pub mod back_of_house {
    pub fn fix_incorrect_order() {
        cook_order();
        crate::front_of_house::serving::serve_order();
    }

    pub fn cook_order() {}
}
```

4. ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ è¯·å°†ä¸Šé¢çš„æ¨¡å—å’Œä»£ç åˆ†ç¦»åˆ°ä»¥ä¸‹ç›®å½•æ–‡ä»¶ä¸­e :
```shell
.
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ back_of_house.rs
â”‚   â”œâ”€â”€ front_of_house
â”‚   â”‚   â”œâ”€â”€ hosting.rs
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â””â”€â”€ serving.rs
â”‚   â”œâ”€â”€ lib.rs
â”‚   â””â”€â”€ main.rs
```

```rust,editable
// in src/lib.rs

// IMPLEMENT...
```

```rust,editable
// in src/back_of_house.rs

// IMPLEMENT...
```


```rust,editable
// in src/front_of_house/mod.rs

// IMPLEMENT...
```

```rust,editable
// in src/front_of_house/hosting.rs

// IMPLEMENT...
```

```rust,editable
// in src/front_of_house/serving.rs

// IMPLEMENT...
```

### ä»äºŒè¿›åˆ¶åŒ…ä¸­è®¿é—®åº“åŒ…çš„ä»£ç 
**è¯·ç¡®ä¿ä½ å·²ç»å®Œæˆäº†ç¬¬å››é¢˜ï¼Œç„¶åå†ç»§ç»­è¿›è¡Œ.**

å½“åˆ°åº•æ­¤å¤„æ—¶ï¼Œä½ çš„é¡¹ç›®ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤º: 
```shell
.
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ back_of_house.rs
â”‚   â”œâ”€â”€ front_of_house
â”‚   â”‚   â”œâ”€â”€ hosting.rs
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â””â”€â”€ serving.rs
â”‚   â”œâ”€â”€ lib.rs
â”‚   â””â”€â”€ main.rs
```

5. ğŸŒŸğŸŒŸğŸŒŸç°åœ¨æˆ‘ä»¬å¯ä»¥ä»äºŒè¿›åˆ¶åŒ…ä¸­å‘èµ·å‡½æ•°è°ƒç”¨äº†.

```rust,editable
// in src/main.rs

// å¡«ç©ºå¹¶ä¿®å¤é”™è¯¯
fn main() {
    assert_eq!(__, "sit down please");
    assert_eq!(__,"yummy yummy!");
}
```

> ä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/sunface/rust-by-practice/blob/master/solutions/crate-module/module.md)æ‰¾åˆ°ç­”æ¡ˆ(åœ¨ solutions è·¯å¾„ä¸‹) 

# use and pub
1. ğŸŒŸ ä½¿ç”¨ `use` å¯ä»¥å°†ä¸¤ä¸ªåŒåç±»å‹å¼•å…¥åˆ°å½“å‰ä½œç”¨åŸŸä¸­ï¼Œä½†æ˜¯åˆ«å¿˜äº† `as` å…³é”®å­—.

```rust,editable
use std::fmt::Result;
use std::io::Result;

fn main() {}
```

2. ğŸŒŸğŸŒŸ å¦‚æœæˆ‘ä»¬åœ¨ä½¿ç”¨æ¥è‡ªåŒä¸€ä¸ªåŒ…æˆ–æ¨¡å—ä¸­çš„å¤šä¸ªä¸åŒé¡¹ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ç®€å•çš„æ–¹å¼å°†å®ƒä»¬ä¸€æ¬¡æ€§å¼•å…¥è¿›æ¥

```rust,editable

// ä½¿ç”¨ä¸¤ç§æ–¹å¼å¡«ç©º
// ä¸è¦æ·»åŠ æ–°çš„ä»£ç è¡Œ
use std::collections::__;

fn main() {
    let _c1:HashMap<&str, i32> = HashMap::new();
    let mut c2 = BTreeMap::new();
    c2.insert(1, "a");
    let _c3: HashSet<i32> = HashSet::new();
}
```

### ä½¿ç”¨ `pub use` è¿›è¡Œå†å¯¼å‡º

3. ğŸŒŸğŸŒŸğŸŒŸ åœ¨ä¹‹å‰åˆ›å»ºçš„`hello-package` çš„åº“åŒ…ä¸­, æ·»åŠ ä¸€äº›ä»£ç è®©ä¸‹é¢çš„ä»£ç èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ
```rust,editable
fn main() {
    assert_eq!(hello_package::hosting::seat_at_table(), "sit down please");
     assert_eq!(hello_package::eat_at_restaurant(),"yummy yummy!");
}
```


### pub(in Crate) 
æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›æŸä¸€ä¸ªé¡¹åªå¯¹ç‰¹å®šçš„åŒ…å¯è§ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ `pub(in Crate)` è¯­æ³•.

#### ç¤ºä¾‹
```rust,editable
pub mod a {
    pub const I: i32 = 3;

    fn semisecret(x: i32) -> i32 {
        use self::b::c::J;
        x + J
    }

    pub fn bar(z: i32) -> i32 {
        semisecret(I) * z
    }
    pub fn foo(y: i32) -> i32 {
        semisecret(I) + y
    }

    mod b {
        pub(in crate::a) mod c {
            pub(in crate::a) const J: i32 = 4;
        }
    }
}
```

### å®Œæ•´ä»£ç 
è‡³æ­¤ï¼ŒåŒ…ä¸æ¨¡å—ç« èŠ‚å·²ç»ç»“æŸï¼Œå…³äº `hello-package` çš„å®Œæ•´ä»£ç å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/sunface/rust-by-practice/tree/master/practices/hello-package) æ‰¾åˆ°.


> ä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/sunface/rust-by-practice/blob/master/solutions/crate-module/use-pub.md)æ‰¾åˆ°ç­”æ¡ˆ(åœ¨ solutions è·¯å¾„ä¸‹) 